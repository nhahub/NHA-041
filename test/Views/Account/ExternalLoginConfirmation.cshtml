@using test.ViewModels
@model ExternalLoginConfirmationViewModel
@{
    ViewData["Title"] = "Complete Registration";
}

<section class="auth-section">
    <div class="form-container">
        <div class="form-header">
            <h1 class="form-title">Complete Profile</h1>
            <p class="form-description">Please confirm your details to continue</p>
        </div>

        <form asp-action="ExternalLoginConfirmation" asp-route-returnurl="@ViewData["ReturnUrl"]" method="post">
            <div asp-validation-summary="All" class="text-danger mb-3"></div>

            <div class="form-group">
                <label asp-for="Username" class="form-label">Username</label>
                <input asp-for="Username" class="form-input" placeholder="Choose a username" required />
                <span asp-validation-for="Username" class="text-danger"></span>
            </div>

            <input type="hidden" asp-for="Email" />

            <div class="form-group">
                <label asp-for="PhoneNumber" class="form-label">Phone Number</label>
                <input type="tel" asp-for="PhoneNumber" class="form-input" placeholder="Enter your phone number" required />
                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="form-label">I am a...</label>
                <div class="role-selector">
                    <div class="role-card">
                        <input type="radio" asp-for="Role" value="User" required checked />
                        <div class="role-card-content">
                            <i class="fas fa-user role-icon"></i>
                            <div>Pet Adopter</div>
                        </div>
                    </div>
                    <div class="role-card">
                        <input type="radio" asp-for="Role" value="Shelter" required />
                        <div class="role-card-content">
                            <i class="fas fa-home role-icon"></i>
                            <div>Shelter</div>
                        </div>
                    </div>
                </div>
                <span asp-validation-for="Role" class="text-danger"></span>
            </div>

            <!-- User Location (City Dropdown) -->
            <div class="form-group" id="userLocationGroup" style="display: none;">
                <label class="form-label"><i class="fas fa-map-marker-alt me-2"></i>Your City</label>
                <select name="Location" id="userLocationSelect" class="form-input">
                    <option value="">-- Select Your City --</option>
                    <option value="Cairo">Cairo</option>
                    <option value="Giza">Giza</option>
                    <option value="Alexandria">Alexandria</option>
                    <option value="Mansoura">Mansoura</option>
                    <option value="Port Said">Port Said</option>
                    <option value="Luxor">Luxor</option>
                    <option value="Aswan">Aswan</option>
                    <option value="Tanta">Tanta</option>
                    <option value="Suez">Suez</option>
                    <option value="Hurghada">Hurghada</option>
                    <option value="Ismailia">Ismailia</option>
                    <option value="Faiyum">Faiyum</option>
                    <option value="Zagazig">Zagazig</option>
                    <option value="Damietta">Damietta</option>
                    <option value="Asyut">Asyut</option>
                    <option value="Minya">Minya</option>
                    <option value="Beni Suef">Beni Suef</option>
                    <option value="Qena">Qena</option>
                    <option value="Sohag">Sohag</option>
                    <option value="Sharm El Sheikh">Sharm El Sheikh</option>
                    <option value="El Gouna">El Gouna</option>
                    <option value="6th of October City">6th of October City</option>
                    <option value="New Cairo">New Cairo</option>
                    <option value="Sheikh Zayed City">Sheikh Zayed City</option>
                </select>
                <span class="text-danger" id="userLocationError"></span>
            </div>

            <!-- Shelter Location (Google Maps Link) -->
            <div class="form-group" id="shelterLocationGroup" style="display: none;">
                <label asp-for="Location" class="form-label"><i class="fas fa-map-marker-alt me-2"></i>Shelter Location (Google Maps Link)</label>
                <input type="url" asp-for="Location" id="shelterLocationInput" class="form-input" 
                       placeholder="https://maps.google.com/..." 
                       pattern="https://(www\.)?(google\.com/maps|maps\.google\.com|goo\.gl/maps|maps\.app\.goo\.gl).*">
                <small class="text-muted">
                    <i class="fas fa-info-circle me-1"></i>
                    Go to Google Maps, find your shelter location, click "Share" and paste the link here
                </small>
                <span asp-validation-for="Location" class="text-danger"></span>
            </div>

            <button type="submit" class="submit-btn">
                <i class="fas fa-check-circle"></i> Complete Registration
            </button>
        </form>
    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const roleInputs = document.querySelectorAll('input[name="Role"]');
            const userLocationGroup = document.getElementById('userLocationGroup');
            const shelterLocationGroup = document.getElementById('shelterLocationGroup');
            const userLocationSelect = document.getElementById('userLocationSelect');
            const shelterLocationInput = document.getElementById('shelterLocationInput');

            function toggleLocationFields() {
                const selectedRole = document.querySelector('input[name="Role"]:checked')?.value;
                
                if (selectedRole === 'User') {
                    userLocationGroup.style.display = 'block';
                    shelterLocationGroup.style.display = 'none';
                    shelterLocationInput.value = '';
                    shelterLocationInput.removeAttribute('required');
                } else if (selectedRole === 'Shelter') {
                    userLocationGroup.style.display = 'none';
                    shelterLocationGroup.style.display = 'block';
                    userLocationSelect.value = '';
                    shelterLocationInput.setAttribute('required', 'required');
                } else {
                    userLocationGroup.style.display = 'none';
                    shelterLocationGroup.style.display = 'none';
                }
            }

            roleInputs.forEach(input => {
                input.addEventListener('change', toggleLocationFields);
            });

            // Trigger on page load if a role is already selected
            toggleLocationFields();
        });
    </script>
}
